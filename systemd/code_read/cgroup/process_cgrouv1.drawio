<mxfile host="Electron" modified="2023-08-22T07:54:29.752Z" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/21.6.8 Chrome/114.0.5735.289 Electron/25.5.0 Safari/537.36" etag="fvejJqXKI6-zPy2NqWCk" version="21.6.8" type="device">
  <diagram name="第 1 页" id="5NwGpKGonHanH0h-sOw3">
    <mxGraphModel dx="2069" dy="907" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="9sEMiDHK8dDW9VSY0gXr-15" target="9sEMiDHK8dDW9VSY0gXr-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z9MhDciRxU4xK_Jh3mUg-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="9sEMiDHK8dDW9VSY0gXr-41" target="9sEMiDHK8dDW9VSY0gXr-53">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="580" y="710" />
              <mxPoint x="590" y="710" />
              <mxPoint x="590" y="375" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-41" value="main_loop:manager_dispatch_cgroup_realize_queue：分发待实现cgroup queue队列中的unit" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="354" y="1030" width="306" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9sEMiDHK8dDW9VSY0gXr-50" target="9sEMiDHK8dDW9VSY0gXr-41" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z9MhDciRxU4xK_Jh3mUg-1" value="daemon-reload触发cgroup变更" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-20" y="290" width="280" height="685" as="geometry">
            <mxRectangle x="-20" y="290" width="140" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-1" value="daemon-reload修改cgroup：&lt;br&gt;manager_reload" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" vertex="1">
          <mxGeometry x="80" y="50" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-2" value="manager_deserialize" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" vertex="1">
          <mxGeometry x="80" y="140" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" source="9sEMiDHK8dDW9VSY0gXr-1" target="9sEMiDHK8dDW9VSY0gXr-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-4" value="manager_deserialize_units" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" vertex="1">
          <mxGeometry x="65" y="240" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" source="9sEMiDHK8dDW9VSY0gXr-2" target="9sEMiDHK8dDW9VSY0gXr-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-8" value="manager_deserialize_one_unit" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" vertex="1">
          <mxGeometry x="52.5" y="330" width="175" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" source="9sEMiDHK8dDW9VSY0gXr-4" target="9sEMiDHK8dDW9VSY0gXr-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z9MhDciRxU4xK_Jh3mUg-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="Z9MhDciRxU4xK_Jh3mUg-1" source="9sEMiDHK8dDW9VSY0gXr-10" target="9sEMiDHK8dDW9VSY0gXr-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-10" value="unit_deserialize" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" vertex="1">
          <mxGeometry x="65" y="420" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" source="9sEMiDHK8dDW9VSY0gXr-8" target="9sEMiDHK8dDW9VSY0gXr-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" target="9sEMiDHK8dDW9VSY0gXr-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="140" y="570" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-12" value="if(cgroup_realized &amp;amp;&amp;amp; default_invalidate_cgroup):这两个条件含义是cgroup实现了并且DefaultInvalidateCgroup配置为yes(此配置默认yes)：unit_invalidate_cgroup" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" vertex="1">
          <mxGeometry x="10" y="510" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-15" value="unit_add_to_cgroup_realize_queue：所以通过daemon-reload可能会使得cgroup一些配置恢复" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-1" vertex="1">
          <mxGeometry x="10" y="600" width="260" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Z9MhDciRxU4xK_Jh3mUg-4" value="通过dbus或者transient服务修改cgroup" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="290" y="290" width="270" height="450" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-43" value="dbus或者transient服务设置cgroup:transient_unit_from_message ||&amp;nbsp;bus_unit_method_set_properties" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" vertex="1">
          <mxGeometry x="40" y="45" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-44" value="bus_unit_set_properties" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" vertex="1">
          <mxGeometry x="70" y="135" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-45" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" source="9sEMiDHK8dDW9VSY0gXr-43" target="9sEMiDHK8dDW9VSY0gXr-44" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-46" value="UNIT_VTABLE(u)-&amp;gt;bus_commit_properties(u):调用各种unit单元的bus_commit_properties" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" vertex="1">
          <mxGeometry x="40" y="195" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-47" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" source="9sEMiDHK8dDW9VSY0gXr-44" target="9sEMiDHK8dDW9VSY0gXr-46" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-48" value="unit_realize_cgroup" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" vertex="1">
          <mxGeometry x="40" y="285" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-49" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" source="9sEMiDHK8dDW9VSY0gXr-46" target="9sEMiDHK8dDW9VSY0gXr-48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-50" value="unit_add_family_to_cgroup_realize_queue：将同slice内的兄弟姐妹及父slice的unit都加入到realize_queue" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" vertex="1">
          <mxGeometry x="20" y="375" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-4" source="9sEMiDHK8dDW9VSY0gXr-48" target="9sEMiDHK8dDW9VSY0gXr-50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z9MhDciRxU4xK_Jh3mUg-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="9sEMiDHK8dDW9VSY0gXr-48" target="9sEMiDHK8dDW9VSY0gXr-53">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="570" y="605" />
              <mxPoint x="570" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Z9MhDciRxU4xK_Jh3mUg-6" value="cgroup修改流程" style="swimlane;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="290" width="470" height="730" as="geometry">
            <mxRectangle x="950" y="330" width="140" height="30" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-53" value="unit_realize_cgroup_now：实现cgroup_realize_queue队列中的unit的cgroup" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="90" y="40" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-54" value="unit_remove_from_cgroup_realize_queue从队列移除" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="52.5" y="130" width="225" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-53" target="9sEMiDHK8dDW9VSY0gXr-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-56" value="&lt;p style=&quot;margin: 0px; line-height: 100%;&quot; align=&quot;center&quot;&gt;unit_get_target_mask获取cgroup v1对应的mask值，此值为own_mask | sibling_mask | members_mask &amp;amp; cgroup_supported &amp;amp; ~ancestor_disable_mask&lt;/p&gt;&lt;br/&gt;&lt;p style=&quot;margin: 0px; line-height: 100%;&quot; align=&quot;center&quot;&gt;&lt;span style=&quot;font-family:&#39;Microsoft YaHei&#39;; font-size:10pt; color:#191919;&quot;&gt;unit_get_enable_mask获取enable_mask，此mask适用于unified cgroup，即cgroup v2&lt;/span&gt;&lt;/p&gt;" style="whiteSpace=wrap;html=1;rounded=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="20" y="220" width="290" height="90" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-57" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-54" target="9sEMiDHK8dDW9VSY0gXr-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-58" value="unit_has_mask_realized：再一次检查是否需要重新实现cgroup，对于v1检查group_realized &amp;amp;&amp;amp; cgroup_invalidated_mask == 0 &amp;amp;&amp;amp; cgroup_realized_mask，v2最后一个条件不同" style="whiteSpace=wrap;html=1;rounded=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="40" y="340" width="250" height="75" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-59" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-56" target="9sEMiDHK8dDW9VSY0gXr-58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-60" value="unit_realize_cgroup_now_disable：深度优先，从叶子节点开始向上禁用" style="whiteSpace=wrap;html=1;rounded=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="67.5" y="440" width="195" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-61" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-58" target="9sEMiDHK8dDW9VSY0gXr-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-62" value="unit_realize_cgroup_now_enable：从根开始使能cgroup" style="whiteSpace=wrap;html=1;rounded=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="67.5" y="520" width="195" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-63" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-60" target="9sEMiDHK8dDW9VSY0gXr-62" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-64" value="unit_update_cgroup：实现当前unit" style="whiteSpace=wrap;html=1;rounded=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="60" y="600" width="210" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-65" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-62" target="9sEMiDHK8dDW9VSY0gXr-64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-66" value="cgroup_invalidated_mask = 0设置为0，这里我理解和unit_has_mask_realized里面的判断有对上了" style="whiteSpace=wrap;html=1;rounded=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="55" y="660" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-67" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-64" target="9sEMiDHK8dDW9VSY0gXr-66" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-68" value="unit_update_cgroup：通过realized_mask ^ target_mask，来实现cgroup的migrate以及trim" style="rounded=0;whiteSpace=wrap;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="310" y="490" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-69" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-60" target="9sEMiDHK8dDW9VSY0gXr-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-62" target="9sEMiDHK8dDW9VSY0gXr-68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-71" value="cgroup_context_apply：实现对应特性写入" style="whiteSpace=wrap;html=1;rounded=0;" parent="Z9MhDciRxU4xK_Jh3mUg-6" vertex="1">
          <mxGeometry x="310" y="585" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9sEMiDHK8dDW9VSY0gXr-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="Z9MhDciRxU4xK_Jh3mUg-6" source="9sEMiDHK8dDW9VSY0gXr-68" target="9sEMiDHK8dDW9VSY0gXr-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
